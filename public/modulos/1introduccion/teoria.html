<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M√≥dulo 1: Introducci√≥n - NoHaxx</title>
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
  <header>
    <div class="logo">NoHaxx</div>
    <div class="top-buttons">
      <a href="../../modulos.html">Salir del M√≥dulo</a>
    </div>
  </header>

  <div class="lms-container">
    <aside class="lms-sidebar">
      <h3>Introducci√≥n</h3>
      <div class="lms-menu-item unlocked active" id="menu-0">1. Definici√≥n</div>
      <div class="lms-menu-item" id="menu-1">2. La Tr√≠ada CID</div>
      <div class="lms-menu-item" id="menu-2">3. Panorama Amenazas</div>
      <div class="lms-menu-item" id="menu-3">4. ODS</div>
      <div class="lms-menu-item" id="menu-4">5. Tipos de Amenazas</div> 
      <div class="lms-menu-item" id="menu-5">6. Buenas Pr√°cticas</div> 
      <div class="lms-menu-item" id="menu-6">7. S√≠ntesis</div>
    </aside>

    <main class="lms-content">

      <div class="course-step active" id="step-0">
        <h2>Definici√≥n y Alcance</h2>
        
        <p>Los t√©rminos <strong>Seguridad de la Informaci√≥n</strong> y <strong>Ciberseguridad</strong>, aunque a menudo se usan indistintamente, en el √°mbito acad√©mico es fundamental precisarlos. Seg√∫n la norma internacional 
          <span class="tooltip required-interaction" data-tooltip="Est√°ndar internacional que proporciona directrices para mejorar el estado de la ciberseguridad." onmouseover="markInteraction(this)">ISO/IEC 27032</span>, 
          la ciberseguridad se define como:</p>
        
        <blockquote style="border-left:4px solid #2196f3; padding-left:15px; color:#555; font-style:italic;">
          "La preservaci√≥n de la confidencialidad, integridad y disponibilidad de la informaci√≥n en el Ciberespacio".
        </blockquote>

        <button class="btn-reveal required-interaction" onclick="revelar('bloque-extra-1', this)">
          Hay un matiz importante...
        </button>

        <div id="bloque-extra-1" style="display:none;" class="reveal-content">
          <div class="definition-box">
            <p><strong>Ciberseguridad vs. Seguridad de la Informaci√≥n</strong></p>
            <p>Aqu√≠ est√° la clave t√©cnica: La <strong>Seguridad de la Informaci√≥n (<span class="tooltip required-interaction" data-tooltip="Est√°ndar para Sistemas de Gesti√≥n de Seguridad de la Informaci√≥n (SGSI). Protege datos en cualquier formato." onmouseover="markInteraction(this)">ISO 27001</span>)</strong> protege datos en cualquier formato. La <strong>Ciberseguridad</strong> se enfoca exclusivamente en la protecci√≥n de activos digitales y redes.</p>
          </div>

          <button class="btn-reveal required-interaction" onclick="revelar('bloque-extra-2', this)">
            ¬øQu√© activos protegemos?
          </button>
        </div>

        <div id="bloque-extra-2" style="display:none;" class="reveal-content">
          <p>El <span class="tooltip required-interaction" data-tooltip="National Institute of Standards and Technology. Agencia de EE.UU. de referencia en ciberseguridad." onmouseover="markInteraction(this)">NIST</span> ampl√≠a el concepto a la defensa activa. Una estrategia integral protege tres tipos de activos cr√≠ticos:</p>
          <ul style="background: #f9f9f9; padding: 20px 40px; border-radius: 8px; border: 1px solid #eee;">
            <li>üñ•Ô∏è <strong>Infraestructura:</strong> Ordenadores, servidores, redes y dispositivos m√≥viles.</li>
            <li>‚òÅÔ∏è <strong>Servicios:</strong> Software, aplicaciones en la nube y sistemas operativos.</li>
            <li>üìÇ <strong>Informaci√≥n:</strong> Datos personales, propiedad intelectual y secretos comerciales.</li>
          </ul>
        </div>
      </div>

      <div class="course-step" id="step-1">
        <h2>Los Pilares: La Tr√≠ada CID</h2>
        <p>El modelo <strong>CID</strong> (o CIA en ingl√©s) es la piedra angular de la seguridad seg√∫n la familia de normas ISO/IEC 27000. Para que un sistema sea seguro, debe cumplir simult√°neamente estas tres propiedades.</p>

        <div style="text-align: center; margin: 30px 0;">
          <img src="../../img/triada.png" alt="Esquema CID" style="max-width: 100%; height: auto; border-radius: 8px;">
        </div>

        <p><strong>Haz clic en cada pilar de la ciberseguridad para conocer su definici√≥n:</strong></p>

        <div class="cia-container">
          <div class="cia-card required-interaction" onclick="checkCIA(this)">
            <h4>üîí Confidencialidad</h4>
            <p style="display:none; font-size:0.9rem; margin-top:10px;">Garantiza que la informaci√≥n sea privada y no pueda ser accedida por personas no autorizadas.</p>
          </div>
          <div class="cia-card required-interaction" onclick="checkCIA(this)">
            <h4>‚úÖ Integridad</h4>
            <p style="display:none; font-size:0.9rem; margin-top:10px;">Asegura que los datos sean precisos y confiables, y que no hayan sido manipulados o alterados de forma no autorizada.</p>
          </div>
          <div class="cia-card required-interaction" onclick="checkCIA(this)">
            <h4>‚è±Ô∏è Disponibilidad</h4>
            <p style="display:none; font-size:0.9rem; margin-top:10px;">Garantiza que los datos y los sistemas est√©n accesibles para los usuarios leg√≠timos cuando los necesiten.</p>
          </div>
        </div>
        
        <button class="btn-reveal required-interaction" onclick="revelar('bloque-cid-ataques', this)" style="margin-top:20px;">
          ¬øQu√© ocurre cuando fallan?
        </button>
        
        <div id="bloque-cid-ataques" style="display:none;" class="reveal-content">
          <div style="margin-top:30px; background:#fafafa; padding:20px; border-radius:10px; border:1px solid #eee;">
            <h3 style="text-align: center;">Vulneraci√≥n de los Pilares</h3>
            <p>Cada pilar tiene su contrapartida maliciosa:</p>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:15px; text-align:left; margin-top:15px;">
              
              <div style="background:#e3f2fd; padding:15px; border-radius:8px; border-top: 4px solid #2196f3;">
                <strong style="color:#1565c0; display:block; margin-bottom:5px;">‚ö†Ô∏è Filtraci√≥n</strong>
                <span style="font-size:0.85rem">Acceso no autorizado. <br><em>Ej: Robo de contrase√±as o espionaje industrial.</em></span>
              </div>

              <div style="background:#e8f5e9; padding:15px; border-radius:8px; border-top: 4px solid #4caf50;">
                <strong style="color:#2e7d32; display:block; margin-bottom:5px;">‚ö†Ô∏è Alteraci√≥n</strong>
                <span style="font-size:0.85rem">Modificaci√≥n de datos. <br><em>Ej: Cambiar el IBAN de una factura o inyectar c√≥digo en una web.</em></span>
              </div>

              <div style="background:#fff3e0; padding:15px; border-radius:8px; border-top: 4px solid #ff9800;">
                <strong style="color:#ef6c00; display:block; margin-bottom:5px;">‚ö†Ô∏è Interrupci√≥n</strong>
                <span style="font-size:0.85rem">Negaci√≥n de servicio. <br><em>Ej: Ataques DDoS o Ransomware (secuestro de acceso).</em></span>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div class="course-step" id="step-2">
        <h2>El Panorama de Amenazas</h2>
        <p>El panorama de amenazas esta en constante evoluci√≥n. Siguiendo el criterio de <span class="tooltip required-interaction" data-tooltip="Agencia de la Uni√≥n Europea para la Ciberseguridad." onmouseover="markInteraction(this)">ENISA</span>, clasificamos a los actores por su <strong>motivaci√≥n</strong>.</p>
        
        <p><strong>Explora los 4 perfiles:</strong></p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="interactive-item required-interaction" onclick="checkThreat(this)">
            <div style="font-size: 1.5rem;">üí∞</div><strong>Cibercrimen</strong>
            <p style="display:none">Motivaci√≥n: Dinero. Es la amenaza m√°s com√∫n (Ransomware, Phishing). No es personal, es un negocio.</p>
          </div>
          <div class="interactive-item required-interaction" onclick="checkThreat(this)">
            <div style="font-size: 1.5rem;">üì¢</div><strong>Hacktivismo</strong>
            <p style="display:none">Motivaci√≥n: Ideolog√≠a/Protesta o visibilidad. Atacan por ideolog√≠a pol√≠tica o social (DDoS, defacement).</p>
          </div>
          <div class="interactive-item required-interaction" onclick="checkThreat(this)">
            <div style="font-size: 1.5rem;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div><strong>Ciberespionaje</strong>
            <p style="display:none">Motivaci√≥n: informaci√≥n estrat√©gica. Patrocinados por estados para robar propiedad intelectual o secretos.</p>
          </div>
          <div class="interactive-item required-interaction" onclick="checkThreat(this)">
            <div style="font-size: 1.5rem;">üè¢</div><strong>Amenaza Interna</strong>
            <p style="display:none">Proviene de dentro de la organizaci√≥n. Puede ser un empleado desleal o un error humano.</p>
          </div>
        </div>

        <button class="btn-reveal required-interaction" onclick="revelar('bloque-amenaza-humana', this)" style="margin-top:20px;">
          ¬øCu√°l es la amenaza m√°s peligrosa?
        </button>

        <div id="bloque-amenaza-humana" style="display:none;" class="reveal-content">
          <div style="background-color: #fff3e0; border-left: 5px solid #ff9800; padding: 20px; margin-top: 20px;">
            <h3 style="text-align: center;">El Factor Humano: T√ö</h3>
            <p>A pesar de que los hackers con altas habilidades t√©cnicas suelen ser vistos con miedo, las estad√≠sticas del informe <strong>Verizon DBIR</strong> indican que m√°s del <strong>80% de las brechas</strong> involucran el elemento humano.</p>
            <ul>
              <li><strong>Negligencia:</strong> Uso de contrase√±as d√©biles o compartir credenciales.</li>
              <li><strong>Error:</strong> Enviar un archivo confidencial a la persona equivocada.</li>
              <li><strong>Ingenier√≠a Social:</strong> Caer en trampas de manipulaci√≥n.</li>
            </ul>
            <p>Por ello, <strong>el usuario concienciado es la mejor defensa.</strong></p>
          </div>
        </div>
      </div>

      <div class="course-step" id="step-3">
        <h2>Ciberseguridad y Agenda 2030</h2>
        <p>La transformaci√≥n digital es un motor clave para el desarrollo mundial, pero la dependencia de lo digital trae consigo riesgos asociados. La ONU reconoce que <strong>no hay desarrollo sostenible sin un ciberespacio seguro</strong>.</p>
        <p>Tu papel en la ciberseguridad contribuye directamente a dos Objetivos de Desarrollo Sostenible (ODS).</p>
        </p><strong>Haz clic para descubrir c√≥mo:</strong></p>

        <div class="ods-grid">
          <div class="ods-card ods-9 required-interaction" onclick="checkODS(this)">
            <div style="display:flex; align-items:center; gap:15px;">
              <div class="ods-icon" style="color:#fd6925; font-size:2rem; font-weight:bold;">9</div>
              <h4>Industria e Innovaci√≥n</h4>
            </div>
            <div class="ods-detail" style="display:none; margin-top:10px;"><strong>Meta:</strong> Desarrollar infraestructuras resilientes.</p>
            </p>La ciberseguridad protege las <span class="tooltip required-interaction" data-tooltip="Servicios esenciales como luz, agua o transporte, cuya interrupci√≥n tendr√≠a un grave impacto en la seguridad, la salud o la econom√≠a del pa√≠s." onmouseover="markInteraction(this)">Infraestructuras Cr√≠ticas</span>. Sin ella, la innovaci√≥n tecnol√≥gica colapsar√≠a ante sabotajes y ataques</div>
          </div>

          <div class="ods-card ods-16 required-interaction" onclick="checkODS(this)">
            <div style="display:flex; align-items:center; gap:15px;">
              <div class="ods-icon" style="color:#00689d; font-size:2rem; font-weight:bold;">16</div>
              <h4>Paz, Justicia e Instituciones</h4>
            </div>
            <div class="ods-detail" style="display:none; margin-top:10px;"><strong>Meta:</strong> Reducir las corrientes financieras il√≠citas.</p>
            </p>Combate el <strong>cibercrimen organizado</strong> y protege la <span class="tooltip required-interaction" data-tooltip="El derecho de cada persona a probar qui√©n es en el entorno digital de forma segura y privada." onmouseover="markInteraction(this)">Identidad Digital</span>de los ciudadanos, garantizando instituciones fiables.</div>
          </div>
        </div>

        <button class="btn-reveal required-interaction" onclick="revelar('bloque-impacto-real', this)" style="margin-top:30px;">
          ¬øC√≥mo influyo YO en esto?
        </button>

        <div id="bloque-impacto-real" style="display:none;" class="reveal-content">
          <div style="background-color: #e8f5e9; border-left: 5px solid #4caf50; padding: 20px; margin-top: 20px; border-radius:5px;">
            <h3 style="text-align: center;">Tu impacto es real</h3>
            <p>Podr√≠as pensar: <em>"Soy solo un empleado, mi contrase√±a no importa a la ONU"</em>. Pero te equivocas:</p>
            <ul>
              <li>Si tu equipo es infectado, puede formar parte de una <span class="tooltip" data-tooltip="Red de ordenadores infectados (zombies) controlados remotamente por un ciberdelincuente para lanzar ataques masivos sin que los due√±os lo sepan.">Botnet</span> usada para atacar hospitales o redes el√©ctricas.</li>
              <li>Si te roban credenciales, pueden usarse para blanquear dinero que financia el crimen global.</li>
            </ul>
            <p style="margin-top:15px;"><strong>Conclusi√≥n:</strong> La Ciberseguridad es Responsabilidad Social Corporativa (RSC).</p>
          </div>
        </div>
      </div>

      <div class="course-step" id="step-4">
        <h2>Principales Tipos de Amenazas</h2>
        <p>El mundo de las ciberamenazas es enorme, pero existen cuatro categor√≠as esenciales que todo usuario deber√≠a aprender a reconocer.</p> 
        <p><strong>Haz clic en cada tarjeta para desplegar su definici√≥n:</strong></p>
        
        <div class="threat-grid">
          <div class="threat-card required-interaction" onclick="markCard(this)">
            <h3 style="text-align: center;">Malware</h3>
            <div class="threat-desc" style="display:none; margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                <p>T√©rmino general que abarca cualquier software dise√±ado con fines hostiles. No son solo "virus"; incluye <strong>Troyanos</strong> (puertas traseras), <strong>Spyware</strong> (espionaje) y <strong>Gusanos</strong>.</p>
                <p>Su objetivo es la exfiltraci√≥n de datos o el da√±o de sistemas.</p>
            </div>
          </div>

          <div class="threat-card required-interaction" onclick="markCard(this)">
            <h3 style="text-align: center;">Ransomware</h3>
            <div class="threat-desc" style="display:none; margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                <p>La mayor amenaza actual para empresas. Es un software extorsivo que utiliza <strong>cifrado robusto</strong> para bloquear el acceso a la informaci√≥n.</p> 
                <p>Los criminales exigen un rescate econ√≥mico para restaurar la <strong>Disponibilidad</strong> de los datos.</p>
            </div>
          </div>

          <div class="threat-card required-interaction" onclick="markCard(this)">
            <h3 style="text-align: center;">Phishing e Ing. Social</h3>
            <div class="threat-desc" style="display:none; margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                <p>T√©cnica que no ataca al software, sino a la mente humana.</p>
                <p>Utiliza la suplantaci√≥n de identidad (de bancos, directivos o servicios t√©cnicos) para manipular a la v√≠ctima y conseguir que entregue voluntariamente sus credenciales.</p>
            </div>
          </div>

          <div class="threat-card required-interaction" onclick="markCard(this)">
            <h3 style="text-align: center;">Ataque DDoS</h3>
            <div class="threat-desc" style="display:none; margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                <p><em>Distributed Denial of Service</em>. Consiste en saturar deliberadamente los servidores de una organizaci√≥n con tr√°fico basura proveniente de miles de dispositivos infectados (Botnet), provocando la ca√≠da del servicio.</p>
            </div>
          </div>
        </div>

        <div id="video-amenazas-container" class="required-interaction" style="display:none; margin-top:30px; animation: fadeIn 1s; background: #fff3e0; padding: 15px; border-radius: 8px; border: 1px solid #ffe0b2;">
            <div class="video-box" style="background: transparent; border: none; padding: 0; margin: 0;">
                <h4 style="margin-top:0;">Amenazas comunes</h4>
                <div class="video-responsive">
                    <div id="player-amenazas"></div>
                </div>
            </div>
        </div>

      </div>

      <div class="course-step" id="step-5">
        <h2>Buenas Pr√°cticas Generales</h2>
        <p>Para aprender estas 5 reglas de oro, <strong>une cada concepto con su definici√≥n correcta</strong>.</p>
        <p><em>Haz clic en un cuadro de la izquierda y luego en su pareja de la derecha.</em></p>

        <div class="puzzle-container">
            <div class="puzzle-column puzzle-left">
                <div class="puzzle-item required-interaction" data-id="1" onclick="handlePuzzleClick(this)"><strong>Actualizaciones</strong></div>
                <div class="puzzle-item required-interaction" data-id="2" onclick="handlePuzzleClick(this)"><strong>Backups (3-2-1)</strong></div>
                <div class="puzzle-item required-interaction" data-id="3" onclick="handlePuzzleClick(this)"><strong>Control Dispositivos</strong></div>
                <div class="puzzle-item required-interaction" data-id="4" onclick="handlePuzzleClick(this)"><strong>Contrase√±as</strong></div>
                <div class="puzzle-item required-interaction" data-id="5" onclick="handlePuzzleClick(this)"><strong>Desconfianza</strong></div>
            </div>

            <div class="puzzle-column puzzle-right">
                <div class="puzzle-item" data-id="2" onclick="handlePuzzleClick(this)"><p style="font-size:0.9rem; margin:0;">Copias desconectadas de la red para recuperar datos.</p></div>
                <div class="puzzle-item" data-id="4" onclick="handlePuzzleClick(this)"><p style="font-size:0.9rem; margin:0;">Usar frases largas y activar siempre el 2FA.</p></div>
                <div class="puzzle-item" data-id="1" onclick="handlePuzzleClick(this)"><p style="font-size:0.9rem; margin:0;">Mantener sistema y antivirus al d√≠a para parchear agujeros.</p></div>
                <div class="puzzle-item" data-id="5" onclick="handlePuzzleClick(this)"><p style="font-size:0.9rem; margin:0;">Verificar siempre el remitente antes de abrir adjuntos.</p></div>
                <div class="puzzle-item" data-id="3" onclick="handlePuzzleClick(this)"><p style="font-size:0.9rem; margin:0;">Nunca conectar USBs encontrados en la calle.</p></div>
            </div>
        </div>
        <p id="puzzle-feedback" style="text-align: center; font-weight: bold; margin-top: 15px; min-height: 20px;"></p>
      </div>

      <div class="course-step" id="step-6">
        <h2>S√≠ntesis y Competencias del M√≥dulo</h2>
        <p>A lo largo de este m√≥dulo introductorio, hemos establecido las bases de la seguridad digital. Lejos de ser un problema puramente t√©cnico, la ciberseguridad se configura como un desaf√≠o <strong>multidisciplinar</strong> que requiere una gesti√≥n integral de riesgos.</p>
        <p>Para afrontar el cuestionario de evaluaci√≥n, es crucial que interiorices los siguientes <strong>tres pilares estrat√©gicos</strong>:</p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">

          <div style="background: #fff; border-top: 4px solid #2196f3; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <h4 style="color: #1565c0; margin-top: 0;">1. Precisi√≥n Terminol√≥gica</h4>
            <p style="font-size: 0.9rem; color: #555;">
              Hemos separado la <strong>Ciberseguridad</strong> (protecci√≥n de activos en el ciberespacio, ISO/IEC 27032) de la <strong>Seguridad de la Informaci√≥n</strong> (protecci√≥n del dato en cualquier soporte, ISO 27001).
            </p>
          </div>

          <div style="background: #fff; border-top: 4px solid #4caf50; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <h4 style="color: #2e7d32; margin-top: 0;">2. El Modelo CID</h4>
            <p style="font-size: 0.9rem; color: #555;">
              La seguridad no es un estado binario (seguro/no seguro), sino el cumplimiento simult√°neo de la <strong>Confidencialidad, Integridad y Disponibilidad</strong>. El fallo en uno solo de estos v√©rtices compromete todo el sistema.
            </p>
          </div>

          <div style="background: #fff; border-top: 4px solid #ff9800; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <h4 style="color: #ef6c00; margin-top: 0;">3. La importancia del individuo</h4>
            <p style="font-size: 0.9rem; color: #555;">
              La tecnolog√≠a es robusta, pero el factor humano es el vector de ataque predominante (>80% de brechas). La concienciaci√≥n individual impacta directamente en la <strong>Agenda 2030</strong> (ODS 9 y 16).
            </p>
          </div>

        </div>

        <div style="background-color: #f5f5f5; border-left: 5px solid #607d8b; padding: 20px; margin-bottom: 30px;">
        </p>
          La ciberseguridad ha dejado de ser una funci√≥n exclusiva del departamento de TI para convertirse en una responsabilidad transversal. La resiliencia de la organizaci√≥n depende de la capacidad de cada empleado para identificar anomal√≠as y proteger los activos de informaci√≥n.</p>
        </div>

        <div class="video-box required-interaction" id="video-container-final">
          <div class="video-responsive">
            <div id="player"></div>
          </div>
        </div>

        <p style="margin-top:20px; text-align: center; font-weight: bold;">¬øPreparado para el test?</p>
      </div>

      <div class="navigation-buttons">
        <button class="btn-nav btn-prev" id="prevBtn" onclick="changeStep(-1)">Anterior</button>
        <div style="display:flex;align-items:center;">
          <span id="bloqueo-msg"></span>
          <button class="btn-nav btn-next" id="nextBtn" onclick="tryNextStep()">Siguiente ‚ûú</button>
        </div>
        <a href="examen.html" class="btn-finish" id="finishBtn">Ir al Examen</a>
      </div>

    </main>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>

<script>
    // --- Configuraci√≥n Inicial ---
    let currentStep = 0;
    const totalSteps = 7;
    let stepUnlocked = new Array(totalSteps).fill(false);
    stepUnlocked[0] = true;

    const steps = document.querySelectorAll('.course-step');
    const menuItems = document.querySelectorAll('.lms-menu-item');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const finishBtn = document.getElementById('finishBtn');
    const bloqueoMsg = document.getElementById('bloqueo-msg');

    // --- UI ---
    function updateUI() {
      steps.forEach((step, index) => {
        step.classList.remove('active');
        menuItems[index].classList.remove('active', 'completed', 'unlocked');
        menuItems[index].onclick = null;

        if (index === currentStep) {
          step.classList.add('active');
          menuItems[index].classList.add('active', 'unlocked');
        } else if (index < currentStep || stepUnlocked[index]) {
          menuItems[index].classList.add('unlocked', 'completed');
          menuItems[index].onclick = () => goToStep(index);
        }
      });

      prevBtn.style.visibility = (currentStep === 0) ? 'hidden' : 'visible';

      if (currentStep === totalSteps - 1) {
        nextBtn.style.display = 'none';

        if (checkCurrentStepCompletion()) {
          finishBtn.style.display = 'inline-block';
          finishBtn.style.opacity = '1';
          finishBtn.style.pointerEvents = 'auto';
          finishBtn.textContent = "Ir al Examen";
        } else {
          finishBtn.style.display = 'inline-block';
          finishBtn.style.opacity = '0.5';
          finishBtn.style.pointerEvents = 'none';
          finishBtn.textContent = "Ver v√≠deo para habilitar";
        }
      } else {
        nextBtn.style.display = 'inline-block';
        finishBtn.style.display = 'none';
      }

      bloqueoMsg.style.display = 'none';
    }

    function goToStep(n) {
      if (typeof playerFinal !== "undefined" && playerFinal.pauseVideo) {
        playerFinal.pauseVideo();
      }
      if (typeof playerThreats !== "undefined" && playerThreats.pauseVideo) {
        playerThreats.pauseVideo();
      }

      if (n >= 0 && n < totalSteps && stepUnlocked[n]) {
        currentStep = n;
        updateUI();
      }
    }


    function changeStep(n) {
      if (typeof playerFinal !== "undefined" && playerFinal.pauseVideo) {
        playerFinal.pauseVideo();
      }
      if (typeof playerThreats !== "undefined" && playerThreats.pauseVideo) {
        playerThreats.pauseVideo();
      }

      if (n < 0) {
        currentStep += n;
        if (currentStep < 0) currentStep = 0;
        updateUI();
      }
    }

    // --- Validaciones ---
    function tryNextStep() {
      if (typeof playerFinal !== "undefined" && playerFinal.pauseVideo) {
        playerFinal.pauseVideo();
      }
      if (typeof playerThreats !== "undefined" && playerThreats.pauseVideo) {
        playerThreats.pauseVideo();
      }

      if (checkCurrentStepCompletion()) {
        stepUnlocked[currentStep + 1] = true;
        currentStep++;
        updateUI();
      } else {
        bloqueoMsg.textContent = "No se ha repasado todo el contenido (incluido palabras azules, cuadros interactivos y videos)";
        bloqueoMsg.style.display = "block";

        nextBtn.classList.add('shake');
        setTimeout(() => nextBtn.classList.remove('shake'), 500);
      }
    }

    function checkCurrentStepCompletion() {
      const currentDiv = document.getElementById(`step-${currentStep}`);
      const pendingItems = currentDiv.querySelectorAll('.required-interaction:not(.viewed)');
      return pendingItems.length === 0;
    }

    // --- Interacciones ---
    function markInteraction(element) {
      if (!element.classList.contains('viewed')) {
        element.classList.add('viewed');
        if (checkCurrentStepCompletion()) bloqueoMsg.style.display = 'none';
      }
    }

    function revelar(id, boton) {
      const bloque = document.getElementById(id);
      bloque.style.display = "block";
      boton.style.display = "none";
      boton.classList.add('viewed');
      bloque.scrollIntoView({ behavior: "smooth", block: "center" });

      if (checkCurrentStepCompletion()) bloqueoMsg.style.display = 'none';
    }

    function genericCardCheck(el) {
      const p = el.querySelector('p');
      if (p) p.style.display = 'block';

      if (!el.classList.contains('viewed')) {
        el.classList.add('viewed');

        if (el.classList.contains('cia-card') || el.classList.contains('threat-card') || el.classList.contains('interactive-item')) {
          el.style.backgroundColor = "#e8f5e9";
          el.style.borderColor = "#4caf50";
        }

        if (checkCurrentStepCompletion()) bloqueoMsg.style.display = 'none';
      }
    }

    function checkCIA(el) { genericCardCheck(el); }
    function checkThreat(el) { genericCardCheck(el); }
    function checkODS(el) {
      el.querySelector('.ods-detail').style.display = 'block';
      genericCardCheck(el);
    }

    function markCard(el) {
      const desc = el.querySelector('.threat-desc');
      if (desc) desc.style.display = 'block';

      if (!el.classList.contains('viewed')) {
        el.classList.add('viewed');
        el.style.backgroundColor = "#e8f5e9";
        el.style.borderColor = "#4caf50";

        const parentGrid = el.parentElement;
        if (parentGrid && parentGrid.classList.contains('threat-grid')) {
          const totalCards = parentGrid.querySelectorAll('.threat-card').length;
          const viewedCards = parentGrid.querySelectorAll('.threat-card.viewed').length;

          if (totalCards === viewedCards) {
            const videoContainer = document.getElementById('video-amenazas-container');
            videoContainer.style.display = 'block';
            setTimeout(() => {
              videoContainer.scrollIntoView({ behavior: "smooth", block: "center" });
            }, 300);
          }
        }
        if (checkCurrentStepCompletion()) bloqueoMsg.style.display = 'none';
      }
    }

    function toggleCheck(el) {
      const input = el.querySelector('input');
      if (!el.classList.contains('viewed')) {
        input.checked = true;
        el.classList.add('viewed');
        el.style.backgroundColor = "#e8f5e9";
        if (checkCurrentStepCompletion()) bloqueoMsg.style.display = 'none';
      }
    }

    // --- YOUTUBE API ---
    var playerFinal;
    var playerThreats;

    function onYouTubeIframeAPIReady() {
      playerFinal = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: '6pfBS8Qy_UI',
        events: { 'onStateChange': onFinalStateChange }
      });

      playerThreats = new YT.Player('player-amenazas', {
        height: '100%',
        width: '100%',
        videoId: 'iV6yNj8N1Ko',
        events: { 'onStateChange': onThreatsStateChange }
      });
    }

    function onFinalStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING || event.data === YT.PlayerState.ENDED) {
        const container = document.getElementById('video-container-final');
        if (!container.classList.contains('viewed')) {
          container.classList.add('viewed');
          updateUI();
        }
      }
    }

    function onThreatsStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING || event.data === YT.PlayerState.ENDED) {
        const container = document.getElementById('video-amenazas-container');
        if (!container.classList.contains('viewed')) {
          container.classList.add('viewed');
          updateUI();
        }
      }
    }

    // --- L√ìGICA DEL PUZZLE (PASO 5) ---
    let selectedPuzzleItem = null;

    function handlePuzzleClick(el) {
        if (el.classList.contains('solved')) return;

        // Deseleccionar si clicamos el mismo
        if (selectedPuzzleItem === el) {
            el.classList.remove('selected');
            selectedPuzzleItem = null;
            return;
        }

        // Seleccionar el primero
        if (!selectedPuzzleItem) {
            selectedPuzzleItem = el;
            el.classList.add('selected');
            return;
        }

        // Si clicamos en la misma columna, cambiamos selecci√≥n
        if (selectedPuzzleItem.parentElement === el.parentElement) {
            selectedPuzzleItem.classList.remove('selected');
            selectedPuzzleItem = el;
            el.classList.add('selected');
            return;
        }

        // Comprobar MATCH
        if (selectedPuzzleItem.getAttribute('data-id') === el.getAttribute('data-id')) {
            successMatch(selectedPuzzleItem, el); // Acierto
        } else {
            errorMatch(selectedPuzzleItem, el);   // Error
        }
    }

    function successMatch(item1, item2) {
        item1.classList.remove('selected'); item2.classList.remove('selected');
        item1.classList.add('solved');      item2.classList.add('solved');
        
        // Marcamos como visto para desbloquear el bot√≥n Siguiente
        if(item1.classList.contains('required-interaction')) item1.classList.add('viewed');
        if(item2.classList.contains('required-interaction')) item2.classList.add('viewed');

        selectedPuzzleItem = null;
        document.getElementById('puzzle-feedback').innerText = "‚úÖ ¬°Correcto!";
        document.getElementById('puzzle-feedback').style.color = "green";
        
        if(checkCurrentStepCompletion()) document.getElementById('bloqueo-msg').style.display = 'none';
    }

    function errorMatch(item1, item2) {
        item1.classList.add('error'); item2.classList.add('error');
        document.getElementById('puzzle-feedback').innerText = "‚ùå No coinciden.";
        document.getElementById('puzzle-feedback').style.color = "red";
        setTimeout(() => {
            item1.classList.remove('error'); item2.classList.remove('error');
            item1.classList.remove('selected'); item2.classList.remove('selected');
            selectedPuzzleItem = null;
        }, 500);
    }




    updateUI();
</script>
</body>
</html>