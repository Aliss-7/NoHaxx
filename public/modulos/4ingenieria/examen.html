<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Examen Final: Ingenier√≠a Social</title>
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
  <header>
    <div class="logo">NoHaxx</div>
  </header>

  <main class="main-content">
    <section class="modulo">
      <h2>üé≠ Examen: Detecta el Enga√±o</h2>
      <p>Resuelve estas 3 situaciones laborales donde alguien intenta manipularte. Elige la acci√≥n m√°s segura.</p>
      
      <div class="pregunta examen" data-correcta="b">
        <h3>Caso 1: La Llamada Urgente</h3>
        <p>Recibes una llamada de un supuesto "t√©cnico de Microsoft". Dice que tu equipo est√° emitiendo virus y necesita tu contrase√±a para detenerlo antes de que bloqueen la red de toda la empresa.</p>
        <button data-respuesta="a">Se la doy r√°pidamente para no perjudicar a mis compa√±eros.</button>
        <button data-respuesta="b">Desconf√≠o. Cuelgo y llamo al departamento de IT interno para verificar.</button>
        <button data-respuesta="c">Le pido su n√∫mero de empleado y luego se la doy.</button>
      </div>

      <div class="pregunta examen" data-correcta="c">
        <h3>Caso 2: La Puerta de Entrada</h3>
        <p>Llegas a la oficina y, al pasar tu tarjeta, una persona amable cargada con cajas de "pizzas" te pide que le sujetes la puerta porque no tiene manos libres.</p>
        <button data-respuesta="a">Le sujeto la puerta por educaci√≥n.</button>
        <button data-respuesta="b">Le dejo pasar, pero le pregunto a qui√©n viene a ver.</button>
        <button data-respuesta="c">Le indico que debe llamar a recepci√≥n para que le abran desde dentro.</button>
      </div>

      <div class="pregunta examen" data-correcta="a">
        <h3>Caso 3: La Curiosidad</h3>
        <p>Encuentras un pendrive USB en el suelo del parking con una etiqueta que dice "Despidos 2025 y Bonus".</p>
        <button data-respuesta="a">Lo entrego al departamento de IT sin conectarlo a ning√∫n equipo.</button>
        <button data-respuesta="b">Lo conecto un momento solo para ver si el archivo es real.</button>
        <button data-respuesta="c">Me lo llevo a casa y lo pruebo en mi ordenador personal.</button>
      </div>

      <div class="resultado">
        <p id="puntuacion-examen" style="font-weight:bold; margin-top:20px;"></p>
        <div id="mensaje-final"></div>
      </div>
    </section>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="../../scripts/firebase-config.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const preguntas = document.querySelectorAll('.pregunta.examen');
      const puntuacionTxt = document.getElementById('puntuacion-examen');
      const mensajeFinal = document.getElementById('mensaje-final');
      
      let aciertos = 0;
      let contestadas = 0;
      const total = preguntas.length;

      preguntas.forEach(pregunta => {
        const botones = pregunta.querySelectorAll('button');
        botones.forEach(btn => {
          btn.addEventListener('click', (e) => {
            if(pregunta.classList.contains('contestada')) return;
            pregunta.classList.add('contestada');

            const respuestaUser = e.target.getAttribute('data-respuesta');
            const respuestaCorrecta = pregunta.getAttribute('data-correcta');

            if (respuestaUser === respuestaCorrecta) {
              e.target.style.backgroundColor = '#d4edda';
              e.target.style.borderColor = '#c3e6cb';
              aciertos++;
            } else {
              e.target.style.backgroundColor = '#f8d7da';
              e.target.style.borderColor = '#f5c6cb';
            }
            
            contestadas++;

            if (contestadas === total) {
              finalizarExamen(aciertos);
            }
          });
        });
      });

      function finalizarExamen(nota) {
        puntuacionTxt.textContent = `Tu puntuaci√≥n: ${nota}/${total}`;
        const aprobado = nota >= 2; 

        if (aprobado) {
           mensajeFinal.innerHTML = "<h3 style='color:green'>¬°Manipulaci√≥n Detectada! ‚úÖ</h3><p>Has superado el m√≥dulo.</p>";
           guardarNota(10);
        } else {
           mensajeFinal.innerHTML = "<h3 style='color:red'>Has ca√≠do en la trampa ‚ùå</h3><p>La ingenier√≠a social es sutil. Repasa los tipos de enga√±o.</p><button onclick='location.reload()' class='boton'>Reintentar</button>";
        }
      }

      function guardarNota(puntos) {
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
          if (user) {

            db.collection('userScores').doc(user.uid).set({
              scores: { ingenieria: puntos }
            }, { merge: true }).then(() => {
               mensajeFinal.innerHTML += "<br><a href='../../modulos.html' class='boton' style='margin-top:10px'>Volver a M√≥dulos</a>";
            });
          }
        });
      }
    });
  </script>
</body>
</html>